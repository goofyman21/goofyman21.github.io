<button class="btn" id="open-embed-1">Open Drive Video 1</button>
<button class="btn" id="open-embed-2">Open Drive Video 2</button>

<script>
  const targets = {
    v1: 'https://drive.google.com/file/d/15UDzRR-O7IC4zCOnifkGfvUno_QnE2A8/preview',
    v2: 'https://drive.google.com/file/d/14PMJdnwZrFM0Ksdb9TMxQkn-KB37Cxnn/preview'
  };

  function openCloakedWithDelay(targetUrl, delayMs = 3000) {
    // 1) Open new tab immediately (no 'noopener' so we can write to it)
    const win = window.open('about:blank', '_blank');
    if (!win) {
      alert('Popup blocked. Allow popups and try again.');
      return;
    }

    // 2) Immediately write a loader page that will self-start the timer
    const html = `<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="no-referrer">
  <style>
    :root{--bg:#0b0b12;--text:#e9e9ee;--chrome:rgba(255,255,255,.06)}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
      font-family:system-ui,Segoe UI,Roboto,Arial}
    .bar{position:fixed;inset:12px 12px auto;display:flex;gap:8px;align-items:center;
      background:var(--chrome);backdrop-filter:blur(6px);border-radius:12px;padding:8px 12px;z-index:2}
    .bar .title{font-weight:700}
    .bar button{all:unset;cursor:pointer;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.12)}
    .bar button:hover{background:rgba(255,255,255,.2)}
    .stage{position:fixed;inset:0;display:grid;place-items:center}
    .loader{display:grid;gap:12px;place-items:center;text-align:center}
    .spinner{width:56px;height:56px;border-radius:50%;border:6px solid rgba(255,255,255,.1);
      border-top-color:#7c6cff;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    iframe{position:fixed;inset:0;width:100%;height:100%;border:0;background:#000;display:none}
  </style>
</head>
<body>
  <div class="bar" role="toolbar" aria-label="Player controls">
    <div class="title">Secure Player</div>
    <button onclick="document.documentElement.requestFullscreen?.()">Fullscreen</button>
    <button onclick="window.close()">Close</button>
  </div>

  <div class="stage">
    <div id="loader" class="loader" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <div>Preparing playerâ€¦</div>
      <small>This only takes a few seconds</small>
    </div>
    <iframe id="player"
      allow="autoplay; fullscreen; picture-in-picture"
      allowfullscreen
      referrerpolicy="no-referrer"
      sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-presentation">
    </iframe>
  </div>

  <script>
    const TARGET = ${JSON.stringify(targetUrl)};
    const DELAY = ${Number.isFinite(delayMs) ? delayMs : 3000};
    const frame = document.getElementById('player');
    const loader = document.getElementById('loader');

    setTimeout(() => {
      frame.src = TARGET;             // 3) load the actual embed after delay
      frame.style.display = 'block';
      loader.style.display = 'none';
    }, DELAY);
  <\/script>
</body>
</html>`;

    win.document.open();
    win.document.write(html);
    win.document.close();
  }

  document.getElementById('open-embed-1').addEventListener('click', () => {
    openCloakedWithDelay(targets.v1, 3000); // 3s fake load
  });
  document.getElementById('open-embed-2').addEventListener('click', () => {
    openCloakedWithDelay(targets.v2, 3000);
  });
</script>
